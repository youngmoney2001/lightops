<div class="relative h-full w-full">
  <!-- Contrôles de carte -->
  <div class="absolute top-4 left-4 z-[1000] flex flex-col gap-2">
    <div class="bg-white rounded-lg shadow-lg p-3">
      <div class="flex flex-col gap-2">
        <button (click)="zoomIn()"
                class="p-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition" title="zoom in">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"/>
          </svg>

        </button>
        <button (click)="zoomOut()"
                class="p-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition" title="zoomOut">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M5 10a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z" clip-rule="evenodd"/>
          </svg>
        </button>
        <button (click)="recenter()"
                class="p-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition" title="recenter map">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
          </svg>
        </button>
        <button (click)="fitToBounds()"
                class="p-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition" title="fit to bounds">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Filtres rapides -->
    <div class="bg-white rounded-lg shadow-lg p-4">
      <h3 class="font-bold text-sm mb-3 text-gray-700">Filtres</h3>
      <div class="flex flex-col gap-3">
        <div class="flex items-center">
          <input type="checkbox" id="showTrajectories" [(ngModel)]="showAnimalTrajectories"
                 (change)="toggleAnimalTrajectories()" class="mr-2">
          <label for="showTrajectories" class="text-sm">Trajectoires</label>
        </div>
        <div class="flex items-center">
          <input type="checkbox" id="showGateways" [(ngModel)]="showGateways"
                 (change)="toggleGateways()" class="mr-2">
          <label for="showGateways" class="text-sm">Passerelles</label>
        </div>
        <div class="flex items-center">
          <input type="checkbox" id="showSites" [(ngModel)]="showSites"
                 (change)="toggleSites()" class="mr-2">
          <label for="showSites" class="text-sm">Sites</label>
        </div>
        <div class="flex items-center">
          <input type="checkbox" id="showCoverage" [(ngModel)]="showCoverageHeatmap"
                 (change)="toggleCoverageHeatmap()" class="mr-2">
          <label for="showCoverage" class="text-sm">Couverture</label>
        </div>
      </div>
    </div>
  </div>

  <!-- Informations de carte -->
  <div class="absolute bottom-4 left-4 z-[1000] bg-white rounded-lg shadow-lg p-3">
    <div class="text-sm">
      <div class="font-semibold">Zoom: {{currentZoom}}x</div>
      <div class="text-gray-600">
        {{mapCenter[0].toFixed(4)}}, {{mapCenter[1].toFixed(4)}}
      </div>
    </div>
  </div>

  <!-- Conteneur de carte -->
  <div #mapContainer class="h-full w-full"></div>

  <!-- Animal sélectionné -->
  <div *ngIf="selectedAnimal"
       class="absolute top-4 right-4 z-[1000] bg-white rounded-lg shadow-lg p-4 max-w-sm">
    <div class="flex items-center mb-3">
      <div class="w-12 h-12 rounded-full flex items-center justify-center mr-3"
           [style.backgroundColor]="selectedAnimal.qualityColor">
        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
          <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
          <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
        </svg>
      </div>
      <div>
        <h3 class="font-bold text-lg">{{selectedAnimal.animalName}}</h3>
        <p class="text-sm text-gray-600">{{selectedAnimal.deviceName}}</p>
      </div>
    </div>

    <div class="grid grid-cols-2 gap-2 text-sm mb-3">
      <div class="font-semibold">Position:</div>
      <div>{{selectedAnimal.latitude.toFixed(6)}}, {{selectedAnimal.longitude.toFixed(6)}}</div>
      <div class="font-semibold">Batterie:</div>
      <div>{{selectedAnimal.batteryLevel}}% ({{selectedAnimal.batteryStatus}})</div>
      <div class="font-semibold">Dernière mise à jour:</div>
      <div>{{selectedAnimal.positionTime | date:'short'}}</div>
      <div class="font-semibold">Qualité GPS:</div>
      <div class="flex items-center">
        <div class="w-3 h-3 rounded-full mr-2" [style.backgroundColor]="selectedAnimal.qualityColor"></div>
        {{selectedAnimal.gpsQuality}}
      </div>
    </div>

    <button (click)="monitoringService.setSelectedAnimal(null)"
            class="w-full px-3 py-2 bg-gray-100 text-gray-700 text-sm rounded hover:bg-gray-200 transition">
      Fermer
    </button>
  </div>
</div>
