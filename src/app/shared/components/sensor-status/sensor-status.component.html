<div class="sensor-status flex items-center" role="status" [attr.aria-label]="'Statut: ' + (label || config.label)">

  <!-- Status Indicator -->
  <div class="relative flex items-center justify-center">
    <!-- Pulse ring for online status -->
    <div
      *ngIf="status === 'online'"
      class="absolute rounded-full opacity-50"
      [ngClass]="[config.color, size === 'sm' ? 'h-4 w-4' : size === 'md' ? 'h-5 w-5' : 'h-6 w-6']"
      [class.animate-ping]="status === 'online'"
    ></div>

    <!-- Main status indicator -->
    <div
      class="rounded-full flex items-center justify-center transition-all duration-300"
      [ngClass]="[config.color, sizeClasses, pulseAnimation]"
      [title]="config.label"
    >
      <!-- Optional icon for certain statuses -->
      <ng-container [ngSwitch]="status">
        <!-- Online check icon -->
        <svg
          *ngSwitchCase="'online'"
          class="text-white opacity-90"
          [ngClass]="size === 'sm' ? 'h-1 w-1' : size === 'md' ? 'h-1.5 w-1.5' : 'h-2 w-2'"
          fill="currentColor"
          viewBox="0 0 20 20"
          aria-hidden="true"
        >
          <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
        </svg>

        <!-- Warning icon -->
        <svg
          *ngSwitchCase="'warning'"
          class="text-white opacity-90"
          [ngClass]="size === 'sm' ? 'h-1 w-1' : size === 'md' ? 'h-1.5 w-1.5' : 'h-2 w-2'"
          fill="currentColor"
          viewBox="0 0 20 20"
          aria-hidden="true"
        >
          <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
        </svg>

        <!-- Error icon -->
        <svg
          *ngSwitchCase="'error'"
          class="text-white opacity-90"
          [ngClass]="size === 'sm' ? 'h-1 w-1' : size === 'md' ? 'h-1.5 w-1.5' : 'h-2 w-2'"
          fill="currentColor"
          viewBox="0 0 20 20"
          aria-hidden="true"
        >
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
        </svg>

        <!-- Maintenance icon -->
        <svg
          *ngSwitchCase="'maintenance'"
          class="text-white opacity-90"
          [ngClass]="size === 'sm' ? 'h-1 w-1' : size === 'md' ? 'h-1.5 w-1.5' : 'h-2 w-2'"
          fill="currentColor"
          viewBox="0 0 20 20"
          aria-hidden="true"
        >
          <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
        </svg>
      </ng-container>
    </div>
  </div>

  <!-- Label -->
  <span
    *ngIf="showLabel"
    class="ml-2 text-sm font-medium transition-colors duration-200"
    [ngClass]="{
      'text-status-success': status === 'online',
      'text-gray-500': status === 'offline',
      'text-status-warning': status === 'warning',
      'text-status-danger': status === 'error',
      'text-blue-600': status === 'maintenance'
    }"
  >
    {{ label || config.label }}
  </span>

  <!-- Optional detailed status info (hover tooltip alternative) -->
  <div
    *ngIf="showTooltip"
    class="absolute z-10 mt-8 ml-6 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none"
  >
    <div class="flex items-center">
      <div class="mr-2">
        <div class="rounded-full h-2 w-2" [ngClass]="config.color"></div>
      </div>
      <div>
        <div class="font-semibold">{{ config.label }}</div>
        <div *ngIf="lastUpdate" class="text-gray-300">{{ lastUpdate | date:'HH:mm' }}</div>
        <div *ngIf="sensorId" class="text-gray-300 text-xs">ID: {{ sensorId }}</div>
      </div>
    </div>
  </div>
</div>

<!-- Status legend for multiple sensors (optional) -->
<div *ngIf="showLegend" class="sensor-legend mt-4 pt-4 border-t border-gray-200">
  <h4 class="text-xs font-semibold text-gray-700 uppercase tracking-wider mb-2">LÃ©gende des statuts</h4>
  <div class="grid grid-cols-2 gap-2">
    <div *ngFor="let statusType of statusTypes" class="flex items-center">
      <app-sensor-status
        [status]="statusType.type"
        [size]="'sm'"
        [showLabel]="true"
      ></app-sensor-status>
    </div>
  </div>
</div>
