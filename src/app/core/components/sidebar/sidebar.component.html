<!-- Sidebar -->
<div class="flex flex-col h-full bg-gradient-to-b from-blue-900 to-blue-800 text-white">
  <!-- Logo and toggle -->
  <div class="flex items-center justify-between h-16 px-4 border-b border-blue-700">
    @if (!isCollapsed() || isMobile) {
      <div class="flex items-center space-x-3">
        <div class="w-8 h-8 bg-white rounded-lg flex items-center justify-center">
          <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"></path>
          </svg>
        </div>
        <div>
          <h1 class="text-lg font-bold">Light<span class="text-blue-300">Ops</span></h1>
          <p class="text-xs text-blue-300">Monitoring agricole</p>
        </div>
      </div>
    } @else {
      <div class="w-8 h-8 bg-white rounded-lg flex items-center justify-center mx-auto">
        <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"></path>
        </svg>
      </div>
    }

    <!-- Toggle button (desktop only) -->
    @if (!isMobile) {
      <button
        type="button"
        (click)="onToggle()"
        class="p-1 rounded-md text-blue-300 hover:text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
        <span class="sr-only">{{ collapsed ? 'Étendre' : 'Réduire' }}</span>
        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          @if (collapsed) {
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"></path>
          } @else {
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"></path>
          }
        </svg>
      </button>
    }
  </div>

  <!-- Navigation -->
  <nav class="flex-1 px-2 py-4 space-y-2 overflow-y-auto">
    <!-- Main navigation -->
    @for (item of getFilteredNavItems(navItems); track item.name) {
      <div>
        <button
          type="button"
          (click)="toggleItem(item)"
          [class.bg-blue-700]="isItemActive(item)"
          [class.bg-blue-800]="isItemActive(item)"
          class="group w-full flex items-center px-3 py-2 text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors"
        >
          <!-- Icon -->
          <svg
            [class]="isCollapsed() && !isMobile ? 'mx-auto h-6 w-6' : 'mr-3 h-6 w-6 flex-shrink-0'"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            [attr.aria-hidden]="true"
          >
            <path stroke-linecap="round" stroke-linejoin="round" [attr.stroke-width]="2" [attr.d]="item.icon"></path>
          </svg>

          <!-- Text and badge -->
          @if (!isCollapsed() || isMobile) {
            <span class="flex-1 text-left">{{ item.name }}</span>
            @if (item.badge) {
              <span [ngClass]="item.badgeColor || 'bg-blue-600 text-white'" class="ml-3 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium">
                {{ item.badge }}
              </span>
            }
            @if (item.children) {
              <svg
                [class.transform]="isItemExpanded(item)"
                [class.rotate-90]="isItemExpanded(item)"
                class="ml-3 h-5 w-5 text-blue-300 transition-transform"
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
              </svg>
            }
          }
        </button>

        <!-- Children -->
        @if (item.children && (isItemExpanded(item) || isCollapsed())) {
          <div [class]="isCollapsed() && !isMobile ? 'mt-2 space-y-1' : 'ml-11 mt-1 space-y-1'">
            @for (child of item.children; track child.name) {
              <a
                [routerLink]="[child.path]"
                [routerLinkActive]="'bg-blue-800'"
                [routerLinkActiveOptions]="{ exact: false }"
                class="group flex items-center px-3 py-2 text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors"
                (click)="isMobile && toggle.emit()"
              >
                @if (!isCollapsed() || isMobile) {
                  <svg
                    class="mr-3 h-5 w-5 flex-shrink-0 text-blue-300"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                  </svg>
                  <span>{{ child.name }}</span>
                } @else {
                  <svg
                    class="mx-auto h-5 w-5 text-blue-300"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                  </svg>
                }
              </a>
            }
          </div>
        }
      </div>
    }

    <!-- Admin section -->
    @if (getFilteredNavItems(adminNavItems).length > 0) {
      <div class="pt-6 mt-6 border-t border-blue-700">
        <div class="px-3 mb-2">
          @if (!isCollapsed() || isMobile) {
            <h3 class="text-xs font-semibold text-blue-300 uppercase tracking-wider">Administration</h3>
          } @else {
            <div class="h-px bg-blue-700"></div>
          }
        </div>
        @for (item of getFilteredNavItems(adminNavItems); track item.name) {
          <div>
            <button
              type="button"
              (click)="toggleItem(item)"
              [class.bg-blue-700]="isItemActive(item)"
              class="group w-full flex items-center px-3 py-2 text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors"
            >
              <svg
                [class]="isCollapsed() && !isMobile ? 'mx-auto h-6 w-6' : 'mr-3 h-6 w-6 flex-shrink-0'"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" [attr.stroke-width]="2" [attr.d]="item.icon"></path>
              </svg>
              @if (!isCollapsed() || isMobile) {
                <span class="flex-1 text-left">{{ item.name }}</span>
                @if (item.children) {
                  <svg
                    [class.transform]="isItemExpanded(item)"
                    [class.rotate-90]="isItemExpanded(item)"
                    class="ml-3 h-5 w-5 text-blue-300 transition-transform"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                  >
                    <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                  </svg>
                }
              }
            </button>

            <!-- Children -->
            @if (item.children && (isItemExpanded(item) || isCollapsed())) {
              <div [class]="isCollapsed() && !isMobile ? 'mt-2 space-y-1' : 'ml-11 mt-1 space-y-1'">
                @for (child of item.children; track child.name) {
                  <a
                    [routerLink]="[child.path]"
                    [routerLinkActive]="'bg-blue-800'"
                    [routerLinkActiveOptions]="{ exact: false }"
                    class="group flex items-center px-3 py-2 text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors"
                    (click)="isMobile && toggle.emit()"
                  >
                    @if (!isCollapsed() || isMobile) {
                      <svg
                        class="mr-3 h-5 w-5 flex-shrink-0 text-blue-300"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                      </svg>
                      <span>{{ child.name }}</span>
                    } @else {
                      <svg
                        class="mx-auto h-5 w-5 text-blue-300"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                      </svg>
                    }
                  </a>
                }
              </div>
            }
          </div>
        }
      </div>
    }
  </nav>

  <!-- Bottom navigation -->
  <div class="px-2 py-4 border-t border-blue-700 space-y-2">
    @for (item of getFilteredNavItems(bottomNavItems); track item.name) {
      <div>
        <button
          type="button"
          (click)="toggleItem(item)"
          [class.bg-blue-700]="isItemActive(item)"
          class="group w-full flex items-center px-3 py-2 text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors"
        >
          <svg
            [class]="isCollapsed() && !isMobile ? 'mx-auto h-6 w-6' : 'mr-3 h-6 w-6 flex-shrink-0'"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path stroke-linecap="round" stroke-linejoin="round" [attr.stroke-width]="2" [attr.d]="item.icon"></path>
          </svg>
          @if (!isCollapsed() || isMobile) {
            <span class="flex-1 text-left">{{ item.name }}</span>
            @if (item.children) {
              <svg
                [class.transform]="isItemExpanded(item)"
                [class.rotate-90]="isItemExpanded(item)"
                class="ml-3 h-5 w-5 text-blue-300 transition-transform"
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
              </svg>
            }
          }
        </button>

        <!-- Children -->
        @if (item.children && (isItemExpanded(item) || isCollapsed())) {
          <div [class]="isCollapsed() && !isMobile ? 'mt-2 space-y-1' : 'ml-11 mt-1 space-y-1'">
            @for (child of item.children; track child.name) {
              <a
                [routerLink]="[child.path]"
                [routerLinkActive]="'bg-blue-800'"
                [routerLinkActiveOptions]="{ exact: false }"
                class="group flex items-center px-3 py-2 text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors"
                (click)="isMobile && toggle.emit()"
              >
                @if (!isCollapsed() || isMobile) {
                  <svg
                    class="mr-3 h-5 w-5 flex-shrink-0 text-blue-300"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                  </svg>
                  <span>{{ child.name }}</span>
                } @else {
                  <svg
                    class="mx-auto h-5 w-5 text-blue-300"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                  </svg>
                }
              </a>
            }
          </div>
        }
      </div>
    }

    <!-- User info -->
    @if (user && (!isCollapsed() || isMobile)) {
      <div class="px-3 py-2">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            @if (user.avatar) {
              <img class="h-8 w-8 rounded-full" [src]="user.avatar" alt="">
            } @else {
              <div class="h-8 w-8 rounded-full bg-white flex items-center justify-center">
                <span class="text-blue-600 font-semibold text-sm">
                  {{ getUserInitials() }}
                </span>
              </div>
            }
          </div>
          <div class="ml-3">
            <p class="text-sm font-medium">{{ user.name }}</p>
            <p class="text-xs text-blue-300">{{ getUserRoleLabel() }}</p>
          </div>
        </div>
      </div>
    }
  </div>
</div>
